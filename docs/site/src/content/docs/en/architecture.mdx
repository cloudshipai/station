---
title: Architecture
description: Understanding Station's lightweight runtime architecture
---

# Architecture Overview

Station is designed as a lightweight, secure runtime for deployable sub-agents with a focus on simplicity, security, and production readiness.

## System Architecture

```mermaid
graph TB
    subgraph "Client Interfaces"
        CLI[Station CLI<br/>stn command]
        API[REST API<br/>Port 8080]
        SSH[SSH/TUI Access<br/>Port 2222]
        WS[WebSocket<br/>Real-time updates]
    end
    
    subgraph "Core Runtime"
        Router[Request Router<br/>HTTP/SSH/WS]
        Auth[Authentication<br/>& Authorization]
        Queue[Execution Queue<br/>Background Processing]
        Scheduler[Agent Scheduler<br/>Cron & Events]
    end
    
    subgraph "Service Layer"
        AgentSvc[Agent Management<br/>Creation & Execution]
        MCPSvc[MCP Integration<br/>Tool Discovery]
        ConfigSvc[Configuration<br/>File-based Management]
        SecuritySvc[Security Services<br/>Encryption & Audit]
        WebhookSvc[Webhook Service<br/>Event Notifications]
    end
    
    subgraph "Data Layer"
        SQLite[(SQLite<br/>Development)]
        PostgreSQL[(PostgreSQL<br/>Production)]
        ConfigFiles[Config Files<br/>.json/.yml]
        SecretStore[Encrypted Secrets<br/>AES-256]
        AuditLog[Audit Logs<br/>JSON Lines]
    end
    
    subgraph "External Systems"
        MCPServers[MCP Servers<br/>Filesystem, AWS, etc.]
        AIProviders[AI Providers<br/>OpenAI, Anthropic]
        Webhooks[External Webhooks<br/>Slack, PagerDuty]
        VCS[Version Control<br/>Git repositories]
    end
    
    CLI --> Router
    API --> Router
    SSH --> Router
    WS --> Router
    
    Router --> Auth
    Auth --> Queue
    Auth --> Scheduler
    
    Queue --> AgentSvc
    Scheduler --> AgentSvc
    
    AgentSvc --> MCPSvc
    AgentSvc --> ConfigSvc
    AgentSvc --> SecuritySvc
    AgentSvc --> WebhookSvc
    
    ConfigSvc --> ConfigFiles
    SecuritySvc --> SQLite
    SecuritySvc --> PostgreSQL
    SecuritySvc --> SecretStore
    SecuritySvc --> AuditLog
    
    MCPSvc --> MCPServers
    AgentSvc --> AIProviders
    WebhookSvc --> Webhooks
    ConfigSvc --> VCS
```

## Core Components

### üèóÔ∏è Lightweight Runtime
**45MB Binary** with embedded SQLite for development

- **Low Memory Footprint** - 512MB minimum
- **Container Optimized** - Perfect for Docker/K8s
- **Multi-Interface** - CLI, REST, SSH, WebSocket
- **Production Ready** - Queue-based execution

### ü§ñ Agent Management
**Intelligent Sub-Agent Orchestration**

- **Agent Lifecycle** - Create, deploy, monitor, scale
- **Environment Isolation** - Dev/staging/prod separation
- **Template System** - Reusable agent bundles
- **Scheduling** - Cron-based and event-driven

### üîß MCP Integration
**Model Context Protocol Support**

- **Tool Discovery** - Automatic MCP server detection
- **Configuration Management** - GitOps-ready configs
- **20+ Built-in Tools** - Filesystem, AWS, databases
- **Custom Tools** - Easy integration of your tools

### üîí Security Layer
**Enterprise-Grade Security**

- **Self-Hosted** - Complete data sovereignty
- **AES Encryption** - Secrets and sensitive data
- **Audit Logging** - Complete execution trail
- **Access Controls** - Role-based permissions

## Data Flow

```mermaid
sequenceDiagram
    participant User
    participant CLI
    participant Runtime
    participant Agent
    participant MCP
    participant AI
    
    User->>CLI: stn agent run 1 "task"
    CLI->>Runtime: POST /api/v1/agents/1/queue
    Runtime->>Runtime: Authenticate & validate
    Runtime->>Agent: Queue execution
    
    loop Agent Execution
        Agent->>MCP: Discover available tools
        MCP-->>Agent: Tool definitions
        Agent->>AI: Generate execution plan
        AI-->>Agent: Step-by-step actions
        Agent->>MCP: Execute tool calls
        MCP-->>Agent: Tool responses
        Agent->>Runtime: Update execution status
    end
    
    Agent->>Runtime: Execution complete
    Runtime->>CLI: Stream results
    CLI-->>User: Display output
    
    Note over Runtime: Audit log, webhooks,<br/>metrics collection
```

## File System Layout

Station follows a standard configuration layout for predictable deployment:

```
# Development (default)
~/.config/station/
‚îú‚îÄ‚îÄ station.db              # SQLite database
‚îú‚îÄ‚îÄ environments/
‚îÇ   ‚îú‚îÄ‚îÄ development/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agents/          # Agent definitions (.prompt files)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ *.json           # MCP configurations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ variables.yml    # Environment variables
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îî‚îÄ‚îÄ production/
‚îú‚îÄ‚îÄ secrets/                 # Encrypted secrets (AES-256)
‚îú‚îÄ‚îÄ audit/                   # Audit logs (JSONL)
‚îî‚îÄ‚îÄ cache/                   # Temporary execution cache

# Production (configurable)
/opt/station/
‚îú‚îÄ‚îÄ config/                  # Configuration files
‚îú‚îÄ‚îÄ data/                    # PostgreSQL data
‚îú‚îÄ‚îÄ logs/                    # Application logs
‚îî‚îÄ‚îÄ backup/                  # Database backups
```

## Environment Isolation

Station provides complete isolation between environments:

```mermaid
graph LR
    subgraph "Development"
        DevDB[(SQLite<br/>Development)]
        DevAgents[Dev Agents<br/>Test tools]
        DevVars[Dev Variables<br/>Local paths]
    end
    
    subgraph "Staging"
        StageDB[(SQLite/PostgreSQL<br/>Staging)]
        StageAgents[Staging Agents<br/>Safe tools]
        StageVars[Staging Variables<br/>Test credentials]
    end
    
    subgraph "Production"
        ProdDB[(PostgreSQL<br/>Production)]
        ProdAgents[Production Agents<br/>All tools]
        ProdVars[Production Variables<br/>Real credentials]
    end
    
    DevDB -.-> StageDB
    StageDB -.-> ProdDB
    
    DevAgents -.-> StageAgents
    StageAgents -.-> ProdAgents
    
    DevVars -.-> StageVars
    StageVars -.-> ProdVars
```

## Security Architecture

### üîê Encryption at Rest
- **AES-256 encryption** for all secrets and sensitive variables
- **Encrypted database fields** for credentials and tokens
- **Secure key derivation** using PBKDF2 with salt
- **Key rotation support** for long-term security

### üö™ Access Control
- **Environment-based isolation** prevents cross-environment access
- **Role-based permissions** for different user types
- **API key authentication** for programmatic access
- **SSH key authentication** for secure terminal access

### üìä Audit Trail
- **Complete execution logging** for all agent activities
- **Configuration change tracking** with Git integration
- **Access logging** for all API and SSH connections
- **Compliance reporting** for security audits

### üåê Network Security
- **TLS encryption** for all external communications
- **Configurable firewall rules** for port restrictions
- **Webhook signature validation** for trusted notifications
- **Zero-trust architecture** - verify all requests

## Deployment Patterns

### Single-Node Development

```mermaid
graph TB
    subgraph "Developer Machine"
        StationBin[Station Binary<br/>stn command]
        SQLiteDB[(SQLite<br/>Local database)]
        ConfigFiles[Config Files<br/>Git tracked]
        LocalMCP[Local MCP<br/>Filesystem tools]
    end
    
    StationBin --> SQLiteDB
    StationBin --> ConfigFiles
    StationBin --> LocalMCP
```

### Production Deployment

```mermaid
graph TB
    subgraph "Production Environment"
        LB[Load Balancer<br/>HAProxy/nginx]
        
        subgraph "Station Cluster"
            Station1[Station Instance 1<br/>Primary]
            Station2[Station Instance 2<br/>Replica]
            Station3[Station Instance 3<br/>Replica]
        end
        
        subgraph "Data Layer"
            PGPrimary[(PostgreSQL<br/>Primary)]
            PGReplica[(PostgreSQL<br/>Read Replica)]
            Redis[(Redis<br/>Session store)]
        end
        
        subgraph "Monitoring"
            Prometheus[Prometheus<br/>Metrics]
            Grafana[Grafana<br/>Dashboards]
            AlertManager[Alert Manager<br/>Notifications]
        end
    end
    
    LB --> Station1
    LB --> Station2
    LB --> Station3
    
    Station1 --> PGPrimary
    Station2 --> PGReplica
    Station3 --> PGReplica
    
    Station1 --> Redis
    Station2 --> Redis
    Station3 --> Redis
    
    Station1 --> Prometheus
    Station2 --> Prometheus
    Station3 --> Prometheus
    
    Prometheus --> Grafana
    Prometheus --> AlertManager
```

## Performance Characteristics

### üìà Scalability
- **Agent Concurrency**: 100+ concurrent agent executions
- **API Throughput**: 1000+ requests/second
- **Database**: Scales from SQLite to PostgreSQL cluster
- **Memory**: Linear scaling with agent count

### ‚ö° Response Times
- **Agent Start**: Less than 500ms for simple agents
- **API Latency**: Less than 100ms for status queries  
- **SSH Connection**: Less than 200ms for terminal access
- **Tool Execution**: Depends on MCP server performance

### üíæ Resource Usage
- **Binary Size**: 45MB (includes embedded SQLite)
- **Memory Usage**: 128MB base + 50MB per active agent
- **Disk Space**: 100MB + logs and database
- **CPU Usage**: Less than 5% idle, scales with agent activity

### üîÑ Reliability
- **Uptime**: 99.9%+ with proper deployment
- **Error Recovery**: Automatic agent restart on failure
- **Data Integrity**: ACID compliance with PostgreSQL
- **Backup**: Automated database backup and restore

## Technology Stack

**Runtime:** Go 1.21+, SQLite/PostgreSQL, HTTP/WebSocket servers

**Security:** AES-256, PBKDF2, TLS 1.3, JWT tokens

**Protocols:** HTTP/2, WebSocket, SSH, MCP (Model Context Protocol)

**Storage:** SQLite (dev), PostgreSQL (prod), Git (configs)

**Deployment:** Docker, Kubernetes, systemd, GitHub Actions

## Next Steps

- **[Quick Start](/en/quickstart)** - Get Station running locally and create your first agent
- **[MCP Integration](/en/mcp-integration)** - Learn how Station integrates with Model Context Protocol servers
- **[Production Setup](/en/deployment/production)** - Deploy Station in production with proper security and monitoring